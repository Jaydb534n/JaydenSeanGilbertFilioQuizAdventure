<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Adventure: Literasi & Budaya</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto:wght@400;700&display=swap');

        body {
            margin: 0;
            padding: 0;
            background-color: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Roboto', sans-serif;
            overflow: hidden;
            user-select: none;
        }

        #game-container {
            position: relative;
            width: 800px;
            height: 600px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            background-color: #87CEEB; /* Sky Blue */
            border-radius: 8px;
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* UI Overlay Styles */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            z-index: 10;
            text-align: center;
        }

        .hidden {
            display: none !important;
        }

        h1 {
            font-family: 'Press Start 2P', cursive;
            color: #f1c40f;
            margin-bottom: 20px;
            font-size: 40px;
            text-shadow: 4px 4px #e67e22;
            line-height: 1.5;
        }

        h2 {
            font-family: 'Press Start 2P', cursive;
            font-size: 20px;
            color: #fff;
            margin-bottom: 30px;
        }

        .btn {
            background: #e74c3c;
            border: 4px solid #c0392b;
            color: white;
            padding: 15px 30px;
            font-family: 'Press Start 2P', cursive;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.1s;
            text-transform: uppercase;
        }

        .btn:hover {
            transform: scale(1.05);
            background: #ff5e57;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .instructions-text {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            max-width: 600px;
            line-height: 1.8;
            font-size: 18px;
            margin-bottom: 20px;
        }

        /* Quiz UI */
        #quiz-container {
            background: #fff;
            color: #333;
            width: 70%;
            padding: 30px;
            border-radius: 15px;
            border: 8px solid #34495e;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            z-index: 20;
            display: none; /* Hidden by default */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            flex-direction: column;
        }

        #quiz-question {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .option-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s;
            text-align: left;
            padding-left: 20px;
        }

        .option-btn:hover {
            background: #2980b9;
        }

        /* HUD */
        #hud {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 20px;
            font-family: 'Press Start 2P', cursive;
            font-size: 14px;
            color: white;
            text-shadow: 2px 2px 0 #000;
            z-index: 5;
            pointer-events: none;
        }

        .hud-item span {
            color: #f1c40f;
        }

        /* Controls hint for mobile/desktop */
        #controls-hint {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 14px;
            opacity: 0.7;
            pointer-events: none;
            z-index: 5;
        }

    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    
    <!-- HUD -->
    <div id="hud" class="hidden">
        <div class="hud-item">SKOR: <span id="score-val">0</span></div>
        <div class="hud-item">WAKTU: <span id="time-val">60</span></div>
        <div class="hud-item">LEVEL: <span id="level-val">1</span></div>
    </div>

    <!-- Main Menu -->
    <div id="menu-screen" class="overlay">
        <h1>QUIZ ADVENTURE</h1>
        <h2>Literasi & Budaya Lokal</h2>
        <button class="btn" onclick="startGame()">MULAI PETUALANGAN</button>
        <button class="btn" style="background:#27ae60; border-color:#2ecc71" onclick="showInstructions()">INSTRUKSI</button>
    </div>

    <!-- Instructions -->
    <div id="instructions-screen" class="overlay hidden">
        <h2>CARA BERMAIN</h2>
        <div class="instructions-text">
            <p>1. Gunakan <b>PANAH KANAN</b> atau <b>Tap Kanan Layar</b> untuk berjalan.</p>
            <p>2. Temui <b>Pos Pertanyaan</b> di sepanjang jalan.</p>
            <p>3. Jawab kuis tentang <b>Keamanan Digital</b> dan <b>Budaya Indonesia</b>.</p>
            <p>4. Waktu terus berjalan! Selesaikan level sebelum waktu habis.</p>
        </div>
        <button class="btn" onclick="backToMenu()">KEMBALI</button>
    </div>

    <!-- Quiz Modal -->
    <div id="quiz-container">
        <div id="quiz-category" style="font-size: 12px; color: #7f8c8d; text-transform: uppercase; margin-bottom: 5px; font-weight: bold;">KATEGORI</div>
        <div id="quiz-question">Pertanyaan disini?</div>
        <div id="quiz-options" style="display: flex; flex-direction: column;">
            <!-- Options injected by JS -->
        </div>
        <div id="quiz-feedback" style="text-align: center; margin-top: 10px; font-weight: bold; height: 20px;"></div>
    </div>

    <!-- Game Over / Win -->
    <div id="end-screen" class="overlay hidden">
        <h1 id="end-title">GAME OVER</h1>
        <h2 id="end-score">Skor Akhir: 0</h2>
        <button class="btn" onclick="location.reload()">MAIN LAGI</button>
    </div>
    
    <div id="controls-hint" class="hidden">Tahan Panah Kanan / Layar Kanan untuk Jalan</div>
</div>

<script>
    // --- DATA SOAL (Literasi Digital & Budaya Lokal) ---
    const questions = [
        {
            category: "Literasi Digital",
            question: "Apa tindakan pertama saat menerima link mencurigakan dari nomor asing?",
            options: ["Langsung klik", "Hapus & Blokir", "Bagikan ke teman", "Balas pesan"],
            answer: 1
        },
        {
            category: "Budaya Lokal",
            question: "Rumah adat Honai berasal dari provinsi mana?",
            options: ["Jawa Barat", "Papua", "Sumatera Barat", "Sulawesi Selatan"],
            answer: 1
        },
        {
            category: "Literasi Digital",
            question: "Manakah password yang paling kuat?",
            options: ["tanggal123", "budi1990", "P@ssw0rdKu!23", "admin"],
            answer: 2
        },
        {
            category: "Budaya Lokal",
            question: "Alat musik angklung dimainkan dengan cara?",
            options: ["Dipukul", "Ditiup", "Digoyangkan", "Dipetik"],
            answer: 2
        },
        {
            category: "Literasi Digital",
            question: "Apa fungsi fitur 2FA (Two-Factor Authentication)?",
            options: ["Mempercepat login", "Menambah lapisan keamanan", "Menghapus virus", "Menghemat kuota"],
            answer: 1
        },
        {
            category: "Budaya Lokal",
            question: "Makanan khas rendang berasal dari daerah?",
            options: ["Padang", "Yogyakarta", "Manado", "Betawi"],
            answer: 0
        }
    ];

    // --- SETUP ENGINE ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // Game State
    let state = 'MENU'; // MENU, GAME, QUIZ, END
    let score = 0;
    let timeLeft = 60;
    let level = 1;
    let timerInterval;

    // Player
    const player = {
        x: 50,
        y: 450, // Ground level
        width: 40,
        height: 60,
        color: '#e74c3c',
        speed: 5,
        isMoving: false,
        legFrame: 0
    };

    // Environment
    const groundY = 510;
    const finishLine = 3000; // Panjang level
    let cameraX = 0;
    
    // Quiz Checkpoints (Posisi X dimana soal muncul)
    let checkpoints = [400, 900, 1500, 2100, 2600]; 
    let activeCheckpointIndex = 0;

    // Controls
    const keys = { right: false };

    // --- ASSETS DRAWING (Code generated assets) ---
    function drawPlayer(x, y) {
        // Body
        ctx.fillStyle = player.color;
        ctx.fillRect(x, y, player.width, player.height);
        
        // Head
        ctx.fillStyle = '#f1c40f'; // Skin
        ctx.fillRect(x + 5, y - 20, 30, 20);
        
        // Eyes
        ctx.fillStyle = 'black';
        ctx.fillRect(x + 25, y - 15, 5, 5);

        // Legs (Animation)
        ctx.fillStyle = '#34495e';
        if (player.isMoving) {
            player.legFrame += 0.2;
            const legOffset = Math.sin(player.legFrame) * 10;
            ctx.fillRect(x + 5 + legOffset, y + player.height, 10, 15);
            ctx.fillRect(x + 25 - legOffset, y + player.height, 10, 15);
        } else {
            ctx.fillRect(x + 5, y + player.height, 10, 15);
            ctx.fillRect(x + 25, y + player.height, 10, 15);
        }
    }

    function drawBackground() {
        // Sky
        ctx.fillStyle = '#87CEEB';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Sun
        ctx.fillStyle = '#f1c40f';
        ctx.beginPath();
        ctx.arc(700, 80, 40, 0, Math.PI * 2);
        ctx.fill();

        // Clouds (Parallax simple)
        ctx.fillStyle = 'rgba(255,255,255,0.7)';
        ctx.beginPath();
        ctx.arc(100 - (cameraX * 0.2), 100, 30, 0, Math.PI * 2);
        ctx.arc(140 - (cameraX * 0.2), 100, 40, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.beginPath();
        ctx.arc(400 - (cameraX * 0.3), 150, 50, 0, Math.PI * 2);
        ctx.arc(460 - (cameraX * 0.3), 140, 40, 0, Math.PI * 2);
        ctx.fill();

        // Ground
        ctx.fillStyle = '#2ecc71';
        ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);
        
        // Ground decorative line
        ctx.fillStyle = '#27ae60';
        ctx.fillRect(0, groundY, canvas.width, 10);
    }

    function drawWorldObjects() {
        ctx.save();
        ctx.translate(-cameraX, 0);

        // Draw Finish Line
        ctx.fillStyle = '#fff';
        for(let i=0; i<10; i++) {
            ctx.fillStyle = i % 2 === 0 ? 'black' : 'white';
            ctx.fillRect(finishLine, groundY - 100 + (i*10), 20, 10);
        }
        ctx.fillStyle = 'white';
        ctx.font = "20px 'Press Start 2P'";
        ctx.fillText("FINISH", finishLine - 20, groundY - 110);

        // Draw Checkpoints (Signposts)
        checkpoints.forEach((cpX, index) => {
            if (index >= activeCheckpointIndex) {
                // Pole
                ctx.fillStyle = '#795548';
                ctx.fillRect(cpX, groundY - 80, 10, 80);
                // Board
                ctx.fillStyle = '#e67e22';
                ctx.fillRect(cpX - 25, groundY - 110, 60, 40);
                ctx.fillStyle = '#fff';
                ctx.font = "20px Arial";
                ctx.fillText("?", cpX - 5, groundY - 85);
            }
        });

        // Draw Decorative Trees
        [200, 600, 1100, 1800, 2300, 2800].forEach(treeX => {
            // Trunk
            ctx.fillStyle = '#5d4037';
            ctx.fillRect(treeX, groundY - 60, 20, 60);
            // Leaves
            ctx.fillStyle = '#228b22';
            ctx.beginPath();
            ctx.arc(treeX + 10, groundY - 80, 40, 0, Math.PI * 2);
            ctx.fill();
        });

        // Draw Player logic position
        drawPlayer(player.x, player.y);

        ctx.restore();
    }

    // --- GAME LOGIC ---

    function update() {
        if (state !== 'GAME') return;

        // Movement
        player.isMoving = false;
        if (keys.right) {
            player.x += player.speed;
            player.isMoving = true;
            
            // Camera follow
            if (player.x > 300) {
                cameraX = player.x - 300;
            }
        }

        // Check for Finish
        if (player.x >= finishLine) {
            endGame(true);
        }

        // Check for Quiz Encounter
        if (activeCheckpointIndex < checkpoints.length) {
            let cpX = checkpoints[activeCheckpointIndex];
            // If player hits the checkpoint (simple collision)
            if (player.x >= cpX - 10 && player.x <= cpX + 10) {
                triggerQuiz();
            }
        }
    }

    function draw() {
        drawBackground();
        
        if (state === 'GAME' || state === 'QUIZ') {
            drawWorldObjects();
        }
    }

    function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
    }

    // --- QUIZ LOGIC ---
    function triggerQuiz() {
        state = 'QUIZ';
        player.isMoving = false;
        keys.right = false; // Stop movement force
        
        const qIndex = activeCheckpointIndex % questions.length;
        const qData = questions[qIndex];

        const quizContainer = document.getElementById('quiz-container');
        const qCategory = document.getElementById('quiz-category');
        const qText = document.getElementById('quiz-question');
        const qOptions = document.getElementById('quiz-options');
        const qFeedback = document.getElementById('quiz-feedback');

        qCategory.textContent = qData.category;
        qText.textContent = qData.question;
        qOptions.innerHTML = '';
        qFeedback.textContent = '';
        qFeedback.style.color = 'black';

        qData.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.textContent = `${idx + 1}. ${opt}`;
            btn.onclick = () => handleAnswer(idx, qData.answer);
            qOptions.appendChild(btn);
        });

        quizContainer.style.display = 'flex';
    }

    function handleAnswer(selectedIdx, correctIdx) {
        const feedback = document.getElementById('quiz-feedback');
        const btns = document.querySelectorAll('.option-btn');
        
        btns.forEach(b => b.disabled = true); // Prevent double click

        if (selectedIdx === correctIdx) {
            feedback.textContent = "BENAR! (+100 Poin)";
            feedback.style.color = "green";
            score += 100;
            updateHUD();
            
            // Auto close after 1 sec
            setTimeout(() => {
                closeQuiz();
            }, 1000);
        } else {
            feedback.textContent = "SALAH! (-10 Detik)";
            feedback.style.color = "red";
            timeLeft -= 10;
            updateHUD();
            
            setTimeout(() => {
                closeQuiz();
            }, 1000);
        }
    }

    function closeQuiz() {
        document.getElementById('quiz-container').style.display = 'none';
        state = 'GAME';
        activeCheckpointIndex++; // Move target to next checkpoint
        
        // Push player slightly forward so they don't re-trigger immediately
        player.x += 20; 
    }

    // --- SYSTEM FUNCTIONS ---
    function startGame() {
        document.getElementById('menu-screen').classList.add('hidden');
        document.getElementById('hud').classList.remove('hidden');
        document.getElementById('controls-hint').classList.remove('hidden');
        
        state = 'GAME';
        resetGame();
        
        // Start Timer
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            if (state === 'GAME') {
                timeLeft--;
                updateHUD();
                if (timeLeft <= 0) {
                    endGame(false);
                }
            }
        }, 1000);
    }

    function resetGame() {
        score = 0;
        timeLeft = 60; // 60 seconds
        player.x = 50;
        cameraX = 0;
        activeCheckpointIndex = 0;
        updateHUD();
    }

    function updateHUD() {
        document.getElementById('score-val').textContent = score;
        document.getElementById('time-val').textContent = Math.max(0, timeLeft);
        document.getElementById('level-val').textContent = level;
    }

    function endGame(isWin) {
        state = 'END';
        clearInterval(timerInterval);
        document.getElementById('end-screen').classList.remove('hidden');
        document.getElementById('hud').classList.add('hidden');
        document.getElementById('controls-hint').classList.add('hidden');
        
        const title = document.getElementById('end-title');
        const finalScore = document.getElementById('end-score');
        
        if (isWin) {
            title.textContent = "LEVEL COMPLETE!";
            title.style.color = "#2ecc71";
            finalScore.textContent = `Skor Akhir: ${score + (timeLeft * 10)}`; // Time Bonus
        } else {
            title.textContent = "GAME OVER";
            title.style.color = "#e74c3c";
            finalScore.textContent = `Skor Terakhir: ${score}`;
        }
    }

    function showInstructions() {
        document.getElementById('menu-screen').classList.add('hidden');
        document.getElementById('instructions-screen').classList.remove('hidden');
    }

    function backToMenu() {
        document.getElementById('instructions-screen').classList.add('hidden');
        document.getElementById('menu-screen').classList.remove('hidden');
    }

    // Input Listeners
    window.addEventListener('keydown', (e) => {
        if (state === 'GAME') {
            if (e.key === 'ArrowRight') keys.right = true;
        }
    });

    window.addEventListener('keyup', (e) => {
        if (state === 'GAME') {
            if (e.key === 'ArrowRight') keys.right = false;
        }
    });

    // Mouse/Touch controls for mobile
    const gameContainer = document.getElementById('game-container');
    gameContainer.addEventListener('mousedown', () => { if(state === 'GAME') keys.right = true; });
    gameContainer.addEventListener('mouseup', () => { if(state === 'GAME') keys.right = false; });
    gameContainer.addEventListener('touchstart', (e) => { e.preventDefault(); if(state === 'GAME') keys.right = true; });
    gameContainer.addEventListener('touchend', (e) => { e.preventDefault(); if(state === 'GAME') keys.right = false; });

    // Start Loop
    requestAnimationFrame(gameLoop);

</script>

</body>
</html>
